<% current_uri = request.env['PATH_INFO'] %>
<% second_to_last_post = Post.last.id-1 %>

<section class="posts-list">
    <% if !@posts_list.empty? %>
      <table>
       <% @posts_list.each do |post| %>
        <tr>
          <td class="post-title"><%= link_to "#{raw truncate(post.title, :length => 30)}", params.merge(:page => post) %></td>
        </tr>
    <% end %>
      </table>
    <% else %>
      There are no posts.
    <% end %>
</section>

<% if !@posts.empty? %>
  <% @posts.each do |post| %>
    <section class="main-post">
    <% if current_uri != "/posts" %>
      
        <div class="main-post-title"><%= @posts_list.first.title %></div>
        <div class="main-post-content"><%= raw @posts_list.first.content %></div>
        <div class="main-post-date-time">Published on <%= @posts_list.first.created_at.strftime("%A, %B %e, %Y") %>.</div>

      <footer class="main-post-navigation">
        <div class ="main-post-navigation-next">
         <% if @posts_list.size > 1 %>
           <%= link_to raw("<span id='arrow'>&gt</span>") + " " + Post.find_by_id(second_to_last_post).title, params.merge(:page => @posts_list.size-1) %></span>
         <% end %>
        </div>
      </footer>

    <% else %>

        <div class="main-post-title"><%= post.title %></div>
        <div class="main-post-content"><%= raw post.content %></div>
        <div class="main-post-date-time">Published on <%= post.created_at.strftime("%A, %B %e, %Y") %>.</div>
      
        <footer class="main-post-navigation">
          <div class ="main-post-navigation-next">
            <% if @posts.previous_page %>
              <%= link_to raw("<span id='arrow'>&gt</span>") + " " + Post.find_by_id(post.id-1).title, params.merge(:page => @posts.previous_page) %></span>
            <% end %>
          </div>
        </footer>

    <% end %>
        
    </section>

  <% end %>
<% end %>

<div class="profile">
  <%= image_tag "verdi.jpg" %>
  <span class="greeting">Hello.</span>
</div>


<div class="new-post">
  <%= link_to 'New Post', new_post_path %>
</div>



